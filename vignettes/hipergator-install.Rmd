---
title: "Installing MATSS on the HiPerGator"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{hipergator-install}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

1. Log onto HiPerGator

```bash
    ssh username@hpg2.rc.ufl.edu
```

2. Follow the [installation instructions for Python on HiPerGator](https://github.com/weecology/lab-wiki/wiki/Programming:-HiPerGator-Intro-Guide#installing-python-packages). No need to actually install packages yet.

3. Create a file named .Rprofile to allow for local installs (substiting your 
  username for <USERNAME>):

```bash
    echo '.libPaths(c("/home/<USERNAME>/R_libs", .libPaths()))' >> .Rprofile
```

4. Make sure that you have the specified folder for storing R packages (substiting your 
  username for <USERNAME>):

```bash
   mkdir /home/<USERNAME>/R_libs
```

5. Load and open the R module (this loads R for use)

```bash
    ml R
    R
```

6. In `R`, install the core Python retriever (yes, this happens in `R`, which is kind of magical).

```{r, eval = FALSE}
    install.packages('reticulate')
    library(reticulate)
    conda_install('r-reticulate', 'retriever')
```

If you get an error that the conda environment `'r-reticulate'` does not exist, you may need to create it first. Run the following lines and then retry the `conda_install('r-reticulate', 'retriever')` command:

```{r, eval = FALSE}
    conda_create('r-reticulate')
```

7. Restart R

8. Install the `rdataretriever`

```{r, eval = FALSE}
    remotes::install_github('ropensci/rdataretriever')
    library(rdataretriever)
```

If you get an error about "HTTP error 404" and "Rate limit remaing", you may need to setup a GITHUB_PAT key on HiPerGator - https://happygitwithr.com/github-pat.html

9. Install `MATSS`

```{r, eval = FALSE}
    remotes::install_github("weecology/MATSS")
```

9. To run a `MATSS` pipeline on HiPerGator you will need to setup `drake` to use
slurm for parallel scheduling. See https://github.com/weecology/MATSS-LDATS/ for
an example of how to do this.